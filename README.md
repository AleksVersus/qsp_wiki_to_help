# Сборщик справки из wiki.qsp.org

Данный проект пока что представляет собой набор скриптов, написанных на python, и каждый из скриптов должен запускаться отдельно в определённой последовательности.

В будущем скрипты предполагается слить в один и сделать сборку справки полностью автоматической. Пока что очень многое допиливать придётся руками.

## Этапы сборки

1. Загрузка исходных html-файлов с [wiki.qsp.org](https://wiki.qsp.org)
2. Обработка для подготовки файлов к сборке в формат `chm`.
3. Сборка `chm` c помощью программы **HTML Help Workshop**.

## Первый этап. Выгрузка страниц

1. Для выгрузки страниц достаточно запустить скрипт `qsp_wiki_downloader.py`. Он сам автоматически выгрузит все страницы справки и изображения.
   *В настоящее время изображения выкачиваются некорректно, их нужно закачивать вручную по необходимости*
2. Все страницы и изображения будут сохранены в папке `html_src`.
3. В этой же папке появится файл `url_links_to_files.json`, в котором будут сведены все файлы и прямые url, по которым доступны страницы с этими файлами.
4. **Перемещать и удалять все эти файлы нельзя!!!**

## Второй этап. Подготовка страниц

1. Для базовой подготовки файлов нужно запустить скрипт `to_chm_prepare.py`. Этот скрипт возьмёт все ранее скачанные файлы и подготовит для сборки.
2. Все подготовленные файлы будут пересохранены в папке `html_out`.
3. В папке `html_out` появятся файлы `qsp.hhc`, `qsp.hhk`, которые отвечают за наличие содержания и указателя в конечном файле `chm`.
4. Из файла `qsp.hhc` необходимо удалить последний пункт, ссылающийся на список ключевых слов, так как при подготовке файла `qsp.hhk` будет уничтожен файл `help_keywords.htm`, который и выступает базой для указателя.
5. Следует вручную просмотреть все файлы и скачать нужные изображения в папку `html_out`. Возможно некоторые файлы изображений уже будут доступны в папке `html_src/images`.
6. Файлы изображений нужно не только скачать, но и поправить пути к ним прямо в коде каждого htm-файла.
7. Если вы хотите, чтобы указатель ссылался на конкретное место отдельного файла, вам придётся самостоятельно доработать файл `qsp.hhk`, добавив к каждой ссылке указатель на якорь. Например, `<a href="html_text.htm#printline>*pl</a>"`. Так же вам придётся проставить якоря вручную в каждом файле в том фрагменте и месте, в котором они могут вам понадобиться.
8. Файл `index.htm` можно удалить, а можно не удалять. Файлы не связанные ссылками, не будут добавлены в конечную справку.

## Третий этап. Сборка справки

1. Для сборки `chm` файла вам понадобится специальная программа [HTML Help Workshop](https://www.helpandmanual.com/downloads_mscomp.html), установщик которой лежит в папке `help_workshop`.
2. Далее я бы рекомендовал почитать [вот эту инструкцию](https://help-spravka.ru/blog/11-help/32-create-new-project-in-html-help-workshop). На всякий случай эта инструкция в виде md-файла скопирована в папку `help_workshop`.
3. Но в принципе, если вы дошли до этого этапа, и у вас не сгорела жопа, вы просто начинаете новый проект, закидываете в него все нужные файлы, не забываете отметить `Default file`, и запускаете компиляцию.
4. Внимательно читайте ошибки, они помогут вам понять, что не так с вашим проектом.

## Что дальше?

- Дальше вы распространяете свой `chm` файл справки по QSP среди жильцов вашего ЖэКа,
- а я пытаюсь написать скрипт, который будет генерировать такую же справку только в виде одностраничного html.

**TODO:**

- автоматически удалять ненужные файлы
- автоматически очищать изображения от "кликабельности"
- автоматически исправлять кривые ссылки на изображения
- автоматически добавлять на стартовую страницу лого
- автоматически удалять ссылку на указатель в содержании
- автоматически удалять изображения с кллассом icon
- автоматически исправлять сноски
- автоматически исключать разделы по навигатору и aqsp
- удалить из вики блок про компилируемую версию справки, а в эту встраивать ссылку на вики



## P.S.!!!

> [!important] **Важно!!!**
> Я не описал здесь ошибки, которые обязательно вылезут при работе python-скриптов и прочего, потому что это отнимет много времени. Вы всегда можете установить себе редактор типа qoder, или cursor и попросить LLM разобраться в причинах ошибок. Собственно я так и делал, когда у меня всплывало невесть что.
