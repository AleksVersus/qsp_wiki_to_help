<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU">
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Действия [Документация QSP]</title>
<link href="default.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="page group">
<!-- wikipage start -->
<!-- TOC START -->

<!-- TOC END -->
<p>
<a class="wikilink1" href="help_msgbox.htm" title="help:msgbox">Назад: Окно сообщений</a>
</p>
<h1 class="sectionedit1" id="dejstvija">Действия</h1>
<div class="level1">
<p>
"Менюшные" игры с точки зрения геймплея предоставляют игроку на выбор несколько вариантов действий, которыми он может воспользоваться. Выбрав действие, игрок двигает игру дальше по сюжету, и волне возможно, главный герой при этом совершает описанное действие: съедает кусок пирога, или проникает в чужой сад.
</p>
<p>
Обычно действия отделены от основного описания и представляют собой ряд кликабельных кнопок. В <strong>QSP</strong> для размещения действий есть отдельное окно, оно так и называется <strong>Окно действий</strong>, или <strong>Список действий</strong> (в плеере просто: <strong>Действия</strong>).
</p>
<p>
С этим окном, в зависимости от нужд вашей игры, вы можете проделывать разные манипуляции. Вы можете:
</p>
<ul>
<li class="level1"><div class="li"> Отключать и включать <strong>Окно действий</strong> по своему желанию</div>
</li>
<li class="level1"><div class="li"> Добавлять действия в <strong>Окно действий</strong></div>
</li>
<li class="level1"><div class="li"> Удалять действия из <strong>Окна действий</strong></div>
</li>
<li class="level1"><div class="li"> Полностью очищать <strong>Окно действий</strong></div>
</li>
</ul>
<p>
В названиях действий не важен регистр букв, то есть "Пойти" и "поЙти" - одно и то же действие.
</p>
<p>
При создании действия, <strong>весь код, относящийся к действию, "прикрепляется" к этому действию, но не выполняется</strong>. Этот код будет выполнен только тогда, когда игрок нажмёт на действие (щёлкнет по нему мышью).
</p>
</div>
<h2 class="sectionedit2" id="komandy_dlja_raboty_s_oknom_dejstvij">Команды для работы с Окном действий</h2>
<div class="level2">
</div>
<h3 class="sectionedit3" id="vkljuchenie_i_vykljuchenie_okna_dejstvij">Включение и выключение Окна действий</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <code id="statement_SHOWACTS">SHOWACTS [#выражение]</code> - если значение выражения отлично от 0, то показывает <strong>Список действий</strong>, иначе скрывает его. Пример: <pre class="brush: qsp">
showacts 0 &amp; ! скрываем Окно действий
showacts 1 &amp; ! выводим Окно действий на экран
</pre> Для удобства чтения кода можно заранее определить переменные <code>on</code> и <code>off</code> с соответствующими значениями: <pre class="brush: qsp">
on,off = 1,0
showacts on &amp; ! включаем Окно действий
showacts off &amp; ! выключаем Окно действий
</pre></div>
</li>
</ul>
</div>
<h3 class="sectionedit4" id="komandy_dlja_upravlenija_dejstvijami">Команды для управления действиями</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <code id="statement_ACT">ACT</code> — данная команда добавляет в <strong>Окно действий</strong> кнопку действия.</div>
<ul>
<li class="level2"><div class="li"> У этой команды есть две формы записи:</div>
<ul>
<li class="level3"><div class="li"> Однострочная форма записи:<pre class="brush: qsp">
ACT [$название], [$путь к файлу изображения]: {оператор 1} &amp; {оператор 2} &amp; {оператор 3}
</pre> Здесь <code>[$название]</code> — это надпись (название), которая будет выводиться на кнопке действия, а <code>[$путь к файлу изображения]</code> — путь к файлу изображения, которое так же будет выводиться на кнопке действия перед названием.</div>
<ul>
<li class="level4"><div class="li"> И команда <code>ACT</code> и название, и операторы после двоеточия при такой форме записи должны быть записаны в одну строку.</div>
</li>
<li class="level4"><div class="li"> Когда игрок нажмёт кнопку действия с указанным названием, будут выполнены перечисленные операторы.</div>
</li>
<li class="level4"><div class="li"> Параметр <code>[$путь к файлу изображения]</code> может отсутствовать, при этом действие добавится без изображения.</div>
</li>
</ul>
</li>
<li class="level3"><div class="li" id="statement_END"> Многострочная форма записи: <pre class="brush: qsp">
ACT [$название], [$путь к файлу изображения]:
  {оператор 1}
  {оператор 2}
  {оператор 3}
END
</pre> Здесь точно так же будет создано действие с названием <code>[$название]</code>, перед названием будет выводиться изображение, путь к которому мы указали с помощью параметра <code>[$путь к файлу изображения]</code>, а когда игрок нажмёт на действие, будут выполнены перечисленные операторы. Обратите внимание:</div>
<ul>
<li class="level4"><div class="li"> При многострочной форме записи после двоеточия в той же строке, где находится команда <code>ACT</code> не должно быть ничего.</div>
</li>
<li class="level4"><div class="li"> Все операторы записываются со следующей строки после двоеточия</div>
</li>
<li class="level4"><div class="li"> Многострочная форма обязательно должна завершаться командой <code>END</code> или <code>END ACT</code>.</div>
</li>
</ul>
</li>
</ul>
</li>
<li class="level2"><div class="li"> Примеры: <pre class="brush: qsp">
! действие в однострочной форме записи
act "Сорвать с берёзы яблоко": яблоко += 1 &amp; *pl "Вы сорвали яблоко, спелое белое."

! действие в многострочной форме записи, с изображением
act "Сорвать арбуз с куста", "img/watermelon.png":
  арбуз += 1
  *pl "Вы сорвали арбуз с куста"
end
</pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <code id="statement_DELACT">DELACT [$название]</code> - удаляет действие с указанным названием из списка действий на локации. Если действие с указанным названием не существует, ошибки не будет, плеер просто проигнорирует команду. Примеры: <pre class="brush: qsp">
! удаляем действие с конкретным названием
delact ‘Идти вперед’

! удаляем выделенное действие
delact $selact
</pre></div>
</li>
</ul>
</div>
<h3 class="sectionedit5" id="komandy_ochistki_okna_dejstvij">Команды очистки Окна действий</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <strong><code id="statement_CLA">CLA</code></strong> - очистка списка текущих действий (удаление всех действий из окна действий). Пример: <pre class="brush: qsp">
! это действие при нажатии выведет текст
act "Действие 1":
  *pl "Ехал Грека Через Реку"
end

! это действие при нажатии выведет текст и удалится
act "Действие 2":
  *pl "Видит Грека В Реке Рак"
  delact $selact
end

! это действие при нажатии удалит все действия
act "Очистить окно действий":
  cla
end
</pre></div>
</li>
</ul>
<p>
* <strong><code>CLS</code></strong> - эквивалентно конструкции "<code>CLEAR &amp; *CLEAR &amp; CLA &amp; CMDCLEAR</code>", т.е. очищает все окна кроме списка предметов.
</p>
</div>
<h3 class="sectionedit6" id="funkcii_dlja_obrabotki_dejstvij">Функции для обработки действий</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <code id="func_CURACTS">$CURACTS</code> - данная функция возвращает текущий список действий в виде QSP-кода.</div>
<ul>
<li class="level2"><div class="li"> Действия сохраняются в виде набора операторов <code>ACT</code> с ответствующими параметрами и операциями.</div>
</li>
<li class="level2"><div class="li"> Записав возвращённое функцией значение в переменную, можно восстановить действия с помощью оператора <strong><a class="wikilink1" href="help_dynamical.htm" title="help:dynamical">DYNAMIC</a></strong>. Пример: <pre class="brush: qsp">
! записываем текущие действия в переменную
$actlist=$curacts
! восстанавливаем действия из переменной
dynamic $actlist
</pre></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code id="func_SELACT">$SELACT</code> - данная функция возвращает название выделенного действия в любом месте игры. Пример: <pre class="brush: qsp">
act "Съесть яблоко":
  *pl "Это было очень вкусное яблоко. Жаль, что червивое."
  здоровье=здоровье+100
  delact $selact
end
</pre></div>
</li>
</ul>
</div>
<h2 class="sectionedit7" id="sobytie_vydelenie_dejstvija">Событие "Выделение действия"</h2>
<div class="level2">
<p>
Когда вы наводите курсор мыши на действие, в классическом плеере это действие подсвечивается голубым цветом, и это означает, что действие выделено. При этом функция <strong><code>$SELACT</code></strong>, вызванная в любом месте игры, будет возвращать название такого выделенного действия.
</p>
<p>
<strong>Выделение действия</strong> — это событие, к которому вы можете привязать автоматическое выполнение кода. Делается это с помощью системной переменной <code>$ONACTSEL</code>:
</p>
<ul>
<li class="level1"><div class="li"> <strong><code>$ONACTSEL</code></strong> — системная переменная, куда можно прописать название локации, код на которой будет выполняться при очередном выделении действия.</div>
</li>
</ul>
<p>
Более подробная информация в разделе <a class="wikilink1" href="help_service_locations.htm" title="help:service_locations">"Служебные локации"</a>.
</p>
</div>
<h2 class="sectionedit8" id="lokalnye_peremennye_v_dejstvii">Локальные переменные в действии</h2>
<div class="level2">
<p>
Каждое действие в <strong>QSP</strong> вляется отдельным блоком кода, и потому для него можно назначить локальные переменные. Таким образом можно проводить различные расчёты внутри действия, не затрагивая переменные на локации.
</p>
<p>
</p><pre class="brush: qsp">
яблоки = 245

act "Наколдовать яблоки":
  local яблоки &amp; ! объявляем локальную переменную
  яблоки = val($input('Сколько вам нужно яблок?'))
  яблоки_у_Миши += яблоки
  *pl "Наколдовано яблок: &lt;&lt;яблоки&gt;&gt;"
end

act "Сколько яблок на локации?":
  ! это действие работает с глобальной переменной
  *pl "Яблок на локации: &lt;&lt;яблоки&gt;&gt;"
end
</pre>
</div>
<h2 class="sectionedit9" id="ogranichenija">Ограничения</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Максимальное количество одновременно видимых действий на локации — 50. То есть игрок не сможет увидеть больше пятидесяти действий на экране, сколько бы вы их не добавляли.</div>
</li>
<li class="level1"><div class="li"> Если в списке действий уже есть действие с указанным названием, то новое действие не создаётся, и не заменяет собой уже существующее, плеер просто игнорирует команду <strong>act</strong>. Таким образом нельзя вывести действия с одинаковыми названиями. Пример: <pre class="brush: qsp">
act "Действие 1": *pl "Старое действие."
act "Действие 1": *pl "Новое действие."
</pre></div>
</li>
</ul>
<p>
<a class="wikilink1" href="help_goto.htm" title="help:goto">Вперёд: Переходы</a>
</p>
</div>

<!-- wikipage stop -->
</div></body>
</html>