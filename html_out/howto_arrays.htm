<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//RU">
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Продвинутое использование массивов [Документация QSP]</title>
<link href="default.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="page group">
<!-- wikipage start -->
<!-- TOC START -->

<!-- TOC END -->
<h2 class="sectionedit1" id="prodvinutoe_ispolzovanie_massivov">Продвинутое использование массивов</h2>
<div class="level2">
</div>
<h3 class="sectionedit2" id="dvumernye_massivy_s_chislovymi_indeksami">Двумерные массивы с числовыми индексами</h3>
<div class="level3">
<p>
Реализация двумерного массива через одномерный требует от нас самого малого: понять, как соотносятся координаты ячеек с шириной двумерного массива. Для этого давайте взглянем на формулу:
</p>
<p>
</p><pre class="brush: qsp">
N = x + y * WIDTH
</pre>
<p>
Здесь <code>N</code> - это номер ячейки одномерного массива, <code>WIDTH</code> - ширина двумерного массива, а <code>x</code> и <code>y</code> — координаты ячейки в двумерном массиве.
</p>
<p>
Допустим наш двумерный массив должен иметь ширину 6 и высоту 8 ячеек. Нумерация ячеек как по оси <code>x</code> так и по оси  <code>y</code> начинается с нуля. Таким образом номер ячейки с координатами <code>0,0</code> в одномерном массиве будет:
</p>
<p>
</p><pre class="brush: qsp">
N = 0 + 0 * 6 = 0
</pre>
<p>
Обратите внимание, высота массива в формуле не учитывается, а значит по высоте массив можно растягивать произвольно, используя всё ту же формулу с шириной 6 ячеек. Однако если мы изменим ширину двумерного массива, индексы одномерного массива в пересчёте на координаты ячеек двумерного изменятся.
</p>
<p>
Для понимания, как работает эта формула ознакомьтесь с примером симуляции двумерного массива через одномерный:
</p>
<p>
</p><pre class="brush: qsp">
! Индексы i1  0..8
local i1_max=9    

! Индексы i2  0..5
local i2_max=6

! Заполнение данных массива
loop local i1 = 0 while i1 &lt; i1_max step i1 += 1:
	loop local i2 = 0 while i2 &lt; i2_max step i2 += 1:
		$двумерный_массив[i1*i2_max+i2]='[&lt;&lt;i1&gt;&gt;,&lt;&lt;i2&gt;&gt;]'
	end
end

! Вывод данных массива
loop local i1 = 0 while i1 &lt; i1_max step i1 += 1:
	loop local i2 = 0 while i2 &lt; i2_max step i2 += 1:
		*p $двумерный_массив[i1*i2_max+i2]+'  '
	end
	*nl
end

*nl

!{Результат 
[0,0]  [0,1]  [0,2]  [0,3]  [0,4]  [0,5]  
[1,0]  [1,1]  [1,2]  [1,3]  [1,4]  [1,5]  
[2,0]  [2,1]  [2,2]  [2,3]  [2,4]  [2,5]  
[3,0]  [3,1]  [3,2]  [3,3]  [3,4]  [3,5]  
[4,0]  [4,1]  [4,2]  [4,3]  [4,4]  [4,5]  
[5,0]  [5,1]  [5,2]  [5,3]  [5,4]  [5,5]  
[6,0]  [6,1]  [6,2]  [6,3]  [6,4]  [6,5]  
[7,0]  [7,1]  [7,2]  [7,3]  [7,4]  [7,5]  
[8,0]  [8,1]  [8,2]  [8,3]  [8,4]  [8,5]  
}

!Получение индексов массива через функцию ARRPOS

local $Поиск = '[2,5]'

local i1 = ARRPOS('$двумерный_массив',$Поиск)/i2_max
local i2 = ARRPOS('$двумерный_массив',$Поиск) mod i2_max

if ARRPOS('$двумерный_массив',$Поиск)&lt;&gt;-1 :
	*Nl $Поиск + '=[&lt;&lt;i1&gt;&gt;,&lt;&lt;i2&gt;&gt;]' 
else 
	*Nl 'Элемент не найден'
end
!{Результат 
[2,5]=[2,5]
}
</pre>
<p>
В данном примере использованы функции:
</p>
<ul>
<li class="level1"><div class="li"> <a class="wikilink1" href="help_cycle.htm" title="help:cycle">'LOOP ... WHILE ... STEP ...'</a></div>
</li>
<li class="level3"><div class="li"> <a class="wikilink1" href="help_main.htm" title="help:main">'*NL [$текст]'</a></div>
</li>
<li class="level3"><div class="li"> <a class="wikilink1" href="help_arrays.htm" title="help:arrays">'ARRPOS(...)'</a></div>
</li>
</ul>
</div>
<h3 class="sectionedit3" id="dvumernye_massivy_s_tekstovymi_indeksami">Двумерные массивы с текстовыми индексами</h3>
<div class="level3">
<p>
Пример работы с массивом имеющим текстовые индексы
</p><pre class="brush: qsp">
! Индексы i1  0..3
i1_max=4    

! Индексы i2  0..5
i2_max=6

! Заполнение данных массива 
i1=0
:ПрыгЗадатьМассив1
	i2=0
	:ПрыгЗадатьМассив2
		! Знак двоеточие используется как разделитель 
		! между двумя численными индексами переведенными в текст
		$ДвумерныйМассивТекстовыйИндекс['&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;']='[&lt;&lt;i1&gt;&gt;,&lt;&lt;i2&gt;&gt;]'
		! $МассивИндекс нужен для дальнейшего поиска через ARRPOS/ARRCOMP
		$МассивИндекс['&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;']='&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;'
		! МассивПорядок нужен для использования KILLVAR
		МассивПорядок['&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;']=ARRSIZE('МассивПорядок')
		! Добавлять новый элемент и удалять нужно 
		!только одновременно в 3х массивах
		
		i2+=1
	if i2&lt;i2_max : Jump 'ПрыгЗадатьМассив2'
i1+=1
if i1&lt;i1_max : Jump 'ПрыгЗадатьМассив1'


! Вывод данных массива
i1=0
:ПрыгВыводМассива1
	*Nl 
	i2=0
	:ПрыгВыводМассива2
		*P $ДвумерныйМассивТекстовыйИндекс['&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;']+'  '
		i2+=1
	if i2&lt;i2_max : Jump 'ПрыгВыводМассива2'
i1+=1
if i1&lt;i1_max : Jump 'ПрыгВыводМассива1'

*Nl 

!{ Результат 
[0,0]  [0,1]  [0,2]  [0,3]  [0,4]  [0,5]  
[1,0]  [1,1]  [1,2]  [1,3]  [1,4]  [1,5]  
[2,0]  [2,1]  [2,2]  [2,3]  [2,4]  [2,5]  
[3,0]  [3,1]  [3,2]  [3,3]  [3,4]  [3,5]  
}


!Получение индексов массива через функцию ARRPOS
$Поиск='[3,0]'

N=ARRPOS('$ДвумерныйМассивТекстовыйИндекс',$Поиск)
if N&lt;&gt;-1:
	!Ищем разделитель ':'  в индексе
	K=STRPOS($МассивИндекс[N],':')

	i1=VAL(MID($МассивИндекс[N],0,K-1))
	i2=VAL(MID($МассивИндекс[N],K+1,LEN($МассивИндекс[N])-K))

	*NL $Поиск+'=[&lt;&lt;i1&gt;&gt;,&lt;&lt;i2&gt;&gt;]'
else
	*Nl 'Элемент не найден'
end


!{ Результат 
[3,0]=[3,0]
}

*NL
!Удаление элемента массива через текстовый индекс
$Удалить='&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;'
*NL 'Удаляем элемент с индексом &lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;'

!Получаем номер элемента

N=МассивПорядок[$Удалить]


!Удаляем элемент
KILLVAR '$ДвумерныйМассивТекстовыйИндекс', N
KILLVAR '$МассивИндекс', N
KILLVAR 'МассивПорядок', N

!Еще раз выводим данные массива

i1=0
:ПрыгВыводМассива3
	*Nl 
	i2=0
	:ПрыгВыводМассива4
		if $ДвумерныйМассивТекстовыйИндекс['&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;']&lt;&gt;'':
			*P $ДвумерныйМассивТекстовыйИндекс['&lt;&lt;i1&gt;&gt;:&lt;&lt;i2&gt;&gt;']+'  '
		else
			*P '[DEL]  '
		end
		i2+=1
	if i2&lt;i2_max : Jump 'ПрыгВыводМассива4'
i1+=1
if i1&lt;i1_max : Jump 'ПрыгВыводМассива3'



!{ Результат
Удаляем элемент с индексом 3:0
[0,0]  [0,1]  [0,2]  [0,3]  [0,4]  [0,5]  
[1,0]  [1,1]  [1,2]  [1,3]  [1,4]  [1,5]  
[2,0]  [2,1]  [2,2]  [2,3]  [2,4]  [2,5]  
[DEL]  [3,1]  [3,2]  [3,3]  [3,4]  [3,5]  
}

</pre>
<p>
В данном примере использованы функции:
</p>
<ul>
<li class="level1"><div class="li"> <a class="wikilink1" href="help_arrays.htm" title="help:arrays">'ARRSIZE([$имя])'</a></div>
</li>
<li class="level3"><div class="li"> <a class="wikilink1" href="help_arrays.htm" title="help:arrays">'ARRPOS([#начало],[$имя_массива],[значение])'</a></div>
</li>
<li class="level3"><div class="li"> <a class="wikilink1" href="help_arrays.htm" title="help:arrays">'KILLVAR [$название массива],[#индекс элемента]'</a></div>
</li>
<li class="level3"><div class="li"> <a class="wikilink1" href="help_strings.htm" title="help:strings">'VAL([$стр])'</a></div>
</li>
<li class="level3"><div class="li"> <a class="wikilink1" href="help_strings.htm" title="help:strings">'MID([$стр],[#начало],[#длина])'</a></div>
</li>
<li class="level3"><div class="li"> <a class="wikilink1" href="help_strings.htm" title="help:strings">'LEN([$стр])'</a></div>
</li>
</ul>
</div>
<h3 class="sectionedit4" id="massiv_peremennyx">Массив переменных</h3>
<div class="level3">
<p>
Пример использования индекса в названии массива
</p>
<p>
</p><pre class="brush: qsp">
! Индексы i1  0..5
i1_max=6    

! Индексы i2  0..2
i2_max=3

! Заполнение данных массива 
i1=0
:ПрыгЗадатьМассив1
	i2=0
	:ПрыгЗадатьМассив2
	!названия заполняемых массивов 
	!$МассивПеременных0 , $МассивПеременных1 , $МассивПеременных2
		DYNAMIC {$МассивПеременных}+i1+{['&lt;&lt;i2&gt;&gt;']='[&lt;&lt;i1&gt;&gt;,&lt;&lt;i2&gt;&gt;]' }
		i2+=1
	if i2&lt;i2_max : Jump 'ПрыгЗадатьМассив2'
i1+=1
if i1&lt;i1_max : Jump 'ПрыгЗадатьМассив1'


! Вывод данных массива
i1=0
:ПрыгВыводМассива1
	*Nl 
	i2=0
	:ПрыгВыводМассива2
		DYNAMIC {*P $МассивПеременных}+i1+{['&lt;&lt;i2&gt;&gt;'] +'  '} 
		i2+=1
	if i2&lt;i2_max : Jump 'ПрыгВыводМассива2'
i1+=1
if i1&lt;i1_max : Jump 'ПрыгВыводМассива1'

!{ Результат 
[0,0]  [0,1]  [0,2]  
[1,0]  [1,1]  [1,2]  
[2,0]  [2,1]  [2,2]  
[3,0]  [3,1]  [3,2]  
[4,0]  [4,1]  [4,2]  
[5,0]  [5,1]  [5,2]   
}

</pre>
<p>
В данном примере использованы функции:
</p>
<ul>
<li class="level1"><div class="li"> <a class="wikilink1" href="help_dynamical.htm" title="help:dynamical">'DYNAMIC [$код],[параметр 1],[параметр 2], …'</a></div>
</li>
</ul>
<hr/>
<p>
<a class="wikilink1" href="howto_start.htm" title="howto:start">Назад: Как сделать</a>
</p>
</div>

<!-- wikipage stop -->
</div></body>
</html>